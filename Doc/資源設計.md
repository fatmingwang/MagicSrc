# 資源（Resource）設計總結

目標：整理「如何採集資源 / 採盡後消失 / 再生或尋找新資源點」的系統設計，並提出多種能讓遊戲更有趣的機制與實作建議，方便直接在 C++ OpenGL 專案中實作。

---

## 1. 概念總覽
- 資源以「節點（Resource Node）」為單位存在地圖上（例如：樹叢、礦脈、水域、肥沃地塊）。
- 每個節點有屬性：種類、最大儲量（YieldMax）、當前儲量（YieldCur）、採集速率係數、距離懲罰、再生規則、品質等。
- 工人（Worker）或採集單位派到節點進行採集，節點會隨採集被扣除儲量，當 YieldCur <= 0 時節點進入「枯竭（Depleted）」狀態並暫時無法採集。
- 預設會有一個工人在自動採集食物,避免玩家一開始就產生士兵就GG

---

## 2. 節點資料模型（建議）
```
struct ResourceNode {
  int id;
  ResourceType type; // e.g., WOOD, METAL, FOOD, MONEY(稀有) ...
  float yieldMax;    // 初始總量
  float yieldCur;    // 當前剩餘量
  float gatherRate;  // 基礎採集速率（單位 / 秒 / worker）
  float regenRate;   // 再生速率（枯竭後或部分回復用）
  float respawnDelay;// 枯竭後開始再生的等待時間
  int quality;       // 1..n，影響掉落/效率/稀有性
  bool depleted;     // 當前是否枯竭
  float lastDepletedAt; // 時間戳（用於計算何時開始再生）
  Vector2 position;  // 地圖座標
}
```

---

## 3. 採集流程（執行時）
1. 玩家透過 Gather UI 指派 `workerIds` 到某 `ResourceNode.id`。
2. 每個 worker 在到達節點並開始採集後，系統按秒計算採集收益：
   - 收益 = workerGatherPower * node.gatherRate * node.qualityModifier * terrainModifier
   - 真實扣除：node.yieldCur -= 收益
   - 給玩家資源庫：player.resources[type] += 收益 * deliveryEfficiency（若需運回機制）
3. 同時給 worker 經驗：exp += 收益 * expFactor
4. 若 node.yieldCur <= 0：把 node.depleted = true；觸發枯竭事件，開始 respawn 計時。

細節：
- travel time：派出與回收會有行走時間，若節點距離基地遠，//實際每秒淨增資源要扣除 travel 費用（或用 worker 在路上不可被計算）。
- carry capacity（選項）：若實作運回機制，worker 有負重，需返回基地卸貨。
- auto-collect：開啟後系統自動在附近節點選擇節點與空閒工人搭配。

---

## 4. 節點枯竭與再生
### 枯竭（Depleted）
讓一場遊戲不要拖太久
- 當 yieldCur <= 0，節點進入枯竭：不能再被採集，顯示枯竭狀態（UI/圖示、色彩、殘骸）。
- 記錄 `lastDepletedAt = now`。

### 再生（Regeneration）策略（可選擇）
1. 固定冷卻 + 漸進回復(等級提升後能派N個尋礦人N秒後可以找到新的礦)
   - 節點在枯竭後等待 `respawnDelay`（例如：300 秒），之後以 `regenRate` 緩慢回復 yieldCur（例如每秒回  yieldMax * 0.002），直到滿。
2. 漸進永續型（小量長期再生）
   - 節點不完全枯竭而是降到極低值，接著以小速率永續再生，適用於樹林類資源（鼓勵輪採）。
//3. 全域節點重生或新增
  // - 伺服端或關卡管理器週期性掃描並在地圖空位或候選點隨機生成新的節點（含品質與位置隨機化）。
4. 人為干預觸發再生(等級提升後能派N個尋礦人N秒後可以找到新的礦)
   - 玩家或技能（灌溉、復育、技術研究）可加速某節點再生或永久提高再生率。

建議：對不同資源採用不同策略（例如樹木：漸進再生；礦脈：長冷卻後重新生成在新位置）。

---

## 5. 尋找與發現新資源點（探索機制）
- 初始地圖上並非全部節點「已發現」；玩家需派 `Scout` 或讓 worker 探索特定區域解鎖節點座標。
- Fog-of-War：未揭露區域的節點對玩家不可見或顯示為「未探索」；可設偵查任務。
- 隨機事件：探險隊可能發現高品質或罕見節點（稀有礦脈、遺跡），引入風險/獎勵（守衛怪、地形危險）。

---

## 6. 多人與競爭型場景（可選）
- 有挑戰性的玩法：部分高價值節點會成為「爭奪點」，被標記為 PVP 可搶奪；駐守有收益加成。 
- 公共資源動態平衡：當地區總採集速率過高時，系統會縮短再生間隔或降低掉落，避免無限刷取（亦可作為平衡杠杆）。

---

## 7. 讓資源系統更好玩的想法（Awesome Ideas）
1. 資源『品質』與『歸屬』：質量分層（普通/優良/稀有），優良資源提供更高掉落或特殊素材；高品質節點會吸引 NPC / 野怪守護。 
尋礦人找到新的礦需要派兵去打
礦也要派兵駐守不然會被敵兵打?
2. 臨時『富礦潮』事件：地圖上出現短時間高產的資源熱點（例如暴雨後出現豐水源），促使玩家臨時競爭或調度工人。 
先不要好麻煩,頂多用什麼君主技能能徒然增加收入這樣
3. 採集Mini-Game（選擇性）：在採集時提供簡單互動（時機點按鍵），成功獲得額外資源或更高工具耐久度，增加玩家介入感。 
馬的AI部會生一個給我哦,初次採礦需要用滑畫面或什麼指令來解開這個礦這樣(或是一個簡單的RPG打怪)
4. 可升級的『資源點管理』：玩家可以建造小型設施（伐木場、採礦工棚）來提高同一節點的採集效率或減少再生時間。 
升級也要進入小遊戲
5. 資源運輸線與攻防：長距離資源需設置護送隊或建立運輸線（車隊），被敵人攔截會有丟失，增加宏觀策略。 
沒派兵可能運輸過程會被劫胡,君主技能可以降低被打劫的percent?
//6. 生態與環境回饋：大規模採集會降低附近生態（可體現為動物減少、隨機災害），迫使玩家考量永續與短期收益。 
這個先不要
7. 技能/科技樹影響：研究可提升採集倍率、減少消耗、提高工具耐久或解鎖污染治理讓節點更快再生。 
8. 隱藏資源與遺跡：偶爾在地圖邊緣或洞穴發現一次性稀有資源（一次性目標，廣泛刺激探索）。
//打特殊的怪,機率遇到
9. 工人專精與天賦：工人分專長（伐木/採礦/打魚），專長提高效率，玩家可以培養與分配不同隊伍。 

---

## 8. 實作建議（C++ / OpenGL 專案）
- 資源圖示：把 ResourceNode 的 `depleted` / `quality` 等態映射到 sprites / atlas 的不同 frame（SVG -> PNG atlas）。
- 管理器：新增 `ResourceManager` 負責節點 spawn/regeneration/序列化，並提供查詢 API（FindNearestResource(type,pos)）。
- 事件系統：當節點枯竭 / 再生 / 被佔領時發出事件（EventBus）以便 UI 更新與提示音效。 
- 調試工具：在 Editor 或 Debug 模式下可強制刷新/生成資源、查看所有節點屬性以便平衡調整。

---

## 9. 範例 JSON（節點定義）
```
{
  "id": 1001,
  "type": "WOOD",
  "yieldMax": 1000,
  "yieldCur": 620,
  "gatherRate": 2.0,
  "regenRate": 1.0,
  "respawnDelay": 300,
  "quality": 1,
  "depleted": false,
  "position": {"x":345,"y":220}
}
```

---

## 10. UI 互動設計（Gather 面板）
- 面板顯示要素：
  - 地圖上資源節點列表（已探索 / 未探索分色）與地圖小圖示。
  - 選中節點顯示詳細資訊：類型、品質、YieldCur / YieldMax、gatherRate、respawnDelay、估算 travel time、預估每次運回量。
  - 可用工人清單（包含專精標記與當前狀態），一鍵「派遣一名」或「派遣 N 名」按鈕。
  - 派遣確認視窗顯示：消耗（例：50 食物）、預期回收時間、預估淨收益、是否啟用自動輪採。
- UX 流程：
  1. 玩家在地圖或面板點擊節點 → 彈出詳細面板。
  2. 點「派遣」→ 顯示成本（50 食物）與可選工人數量 → 確認後立即扣資源並分配任務。
  3. 任務過程在面板中顯示進度條（travel / gather / return），並在任務完成時以通知提示獲得資源。

---

## 11. API 與事件（建議）
- ResourceManager API：
  - `ResourceNode* GetNodeById(int id)`
  - `std::vector<ResourceNode*> FindNodesInRadius(Vector2 pos, float r, ResourceType typeFilter)`
  - `bool IsNodeDepleted(int id)`
  - `void Update(float dt)`
  - `int SpawnNode(ResourceType type, Vector2 pos, int quality)`
- Player / Unit API：
  - `bool TryConsumeResource(ResourceType t, int amount)` // returns false if insufficient
  - `AssignWorkerToNode(int workerId,int nodeId)`
  - `OnWorkerReturn(int workerId,int nodeId,float amountCollected)` // event handler
- Events to emit (EventBus):
  - `OnNodeDepleted(nodeId)`
  - `OnNodeRegenerated(nodeId)`
  - `OnWorkerDispatched(workerId,nodeId)`
  - `OnWorkerReturned(workerId,nodeId,amount)`

---

## 12. 調整與平衡建議（快速參考）
- 起始資源與成本：調整初期消耗（例如 50 食物）會直接影響玩家早期策略，建議在 playtest 調整為 20–80 範圍內。
- 採集速率曲線：避免 linear 採集導致速率爆炸，推薦使用遞減產量或加上 travel 成本。
- 節點密度：地圖上高品質節點數量應該比普通節點稀少，使玩家需要探索/競爭。
- 自動採集閾值：當自動採集開啟時，系統優先分配最近且品質合適的節點，並限制每個區域的最大同時工人數以避免瞬間枯竭。

---

## 13. 可量化的 Playtest 指標
- 采集-消耗比（Resource Income / Resource Spend）在早期階段應該為 1.1–1.5。
- 平均 travel time 與 idle time 比率（建議 idle 要比 travel 少，否則玩家會覺得緩慢）。
- 節點枯竭頻率（每場遊戲平均枯竭節點數）與再生時間分佈。
- 玩家行為指標：平均派遣次數、平均同時採集工人數、平均探索比例。

---

## 14. 開發優先任務清單（Sprint 計劃）
1. 基礎 ResourceManager（生成節點 / 查詢 / Update）。
2. Gather UI 最小互動（點擊節點、派遣工人、顯示進度）。
3. Worker 任務狀態機（travel / gather / return / idle）與事件接口。
4. 節點枯竭/再生邏輯與視覺化（depleted 樣式）。
5. 平衡參數面板（調整 yieldMax,gatherRate,respawnDelay）與測試場景。
6. 進階：自動採集策略、專精工人/建築提升、富礦潮事件。

---

## 15. 小結
此擴充內容將資源系統由概念提升為可操作的設計規格（包含 UI、API、平衡與開發優先級），能直接作為 C++ 實作的需求規格。若要我接著產生 `ResourceManager` 的 header 與 stub（`manager-cpp`），或把 UI 示例整合到 `PrototypeGame`（`integrate-prototype`），請回覆你選擇的項目。


每創一個都要玩一次,可以一次創很多個但是就會提升難度?

種田小遊戲   - 關係到有多少田可以種(打地鼠插秧?)
開石礦小遊戲   - 關係到有多少石礦可以挖(抓時間點打破石頭?)
開金礦小遊戲   - 關係到有多少金礦可以挖(運氣刮刮樂)
砍木頭小遊戲   - 關係到有多少木頭可以砍(瘋狂砍木頭)


