# 資源 Mini‑Game 設計（種田 / 開石礦 / 開金礦 / 砍木頭）

目的：為四種資源採集提供有趣的「迷你遊戲」玩法，讓採集不只是等待數值增長而有玩家操作感、風險與回報。每個迷你遊戲都會回傳一個「採集倍率 / 品質提升 / 額外獎勵」給主系統，用於計算本次採集得到的真實資源與可能掉落的稀有素材。

共通設計原則：
- 每場 мини‑game 時間短（10–45 秒），操作簡單，重玩意願高。
- 結果回傳一組數值：BaseYield * multiplier，並有機率掉落稀有物（或觸發負面事件）。
- 玩家等級（Main Level）影響：解鎖高難度版、提高工具屬性、降低失敗懲罰、增加高分獎勵機率。
- 每種小遊戲都支援「快速完成」選項：花費少量資源（或冷卻/付費）直接獲得平均收益。

---

## 1) 種田小遊戲（Farm — 打地鼠式 / 範例：插秧節奏）
概念：在有限的田塊上快速完成「插秧 → 澆水 → 防蟲」三個步驟，成功次數決定收成倍率與額外作物品質。

流程步驟：
1. 選擇要耕作的田塊（每格代表一次 mini‑game 時段）。
2. 小遊戲開始後畫面顯示 N 個方格（例如 6 格），每格會在時間軸隨機出現事件：幼苗（需點擊種植）、水滴（點擊澆水）、害蟲（點擊驅除）。
3. 玩家在時間內點擊正確事件。每次正確 +1 分，失誤扣分或觸發小懲罰（減少時間或暫時失去一格）。
4. 結算：得分轉換為 HarvestMultiplier = 1.0 + clamp(score / maxScore * 1.5, 0, 2.0)。

高分技巧：
- 保持節奏，不要重複點同一格；優先處理害蟲以避免作物減產。
- 連續正確（combo）會額外增加品質點數，品質點數用於提高稀有種子掉率。

與玩家等級關聯：
- 等級↑ 解鎖更多田塊同時操作、增加可用時間、或解鎖自動小幫手（減少一次錯誤影響）。

額外玩法：
- 天氣系統影響（下雨則自動澆水減少步驟但害蟲機率變高）； 
- 每日挑戰：在 30 秒內得到 X 分可獲 Bonus Seed。

---

## 2) 開石礦小遊戲（Quarry — 擊打節奏 / 抓時機）
概念：使用鎬或錘在岩石上擊打，擊中特定「破裂點」或在震動停止瞬間放大力度可獲最大傷害；同時需避免打中弱點導致工具損壞或崩塌。

流程步驟：
1. 顯示一塊岩石與一個節奏指標（或移動條）。條上有多個薄弱點（亮點）。
2. 玩家在指標經過亮點時點擊（timing），命中得高分；普通點擊則為小額收穫；在禁區點擊會損壞工具或增加崩塌風險。
3. 每次正確命中，岩石 HP 降低；達到裂縫 threshold 產出掉落（石料、偶爾稀有礦物）。
4. 若崩塌（觸發太多禁區或誤擊）則中斷，並降低本次收益或對礦脈造成長期懲罰（延長 respawnDelay）。

高分技巧：
- 連擊命中多個亮點可累積力量，觸發「爆裂」使得該次掉落增加品質。
- 設備品質高的玩家容錯率高（工具耐久/精準度）。

與玩家等級關聯：
- 等級↑ 解鎖更好的礦錐/炸藥（在保持風險的前提下快速破碎），或能派尋礦人探索附近新礦脈（需要派軍隊清理守衛）。

額外玩法：
- 小型副本：首次開採高品質礦脈需先打掉守衛群（簡易戰鬥 mini），成功後可長期採掘該礦點。

---

## 3) 開金礦小遊戲（Gold Mine — 刮刮樂 / 風險選擇）
概念：高風險高報酬的小遊戲，類似刮刮樂或選牌機制。玩家在有限次數內挑選格子或刮開區域，選到金符號即獲得高額回報，但有機率觸發「空手」或損壞事件。

流程步驟：
1. 顯示 3x3 或 4x4 的格子，初始顯示少量提示（例如熱度、弱光）用於推理。玩家有 M 次刮開機會。
2. 玩家刮開格子揭露內容：金、石、陷阱。金給予高額回報與稀有金塊；陷阱會觸發小懲罰（工具損壞或暫停採掘）。
3. 玩家可選擇「停止並兌換」或繼續冒險，繼續會增加風險但可能提高總回報（押注機制）。

高分技巧：
- 根據提示收集概率信息，若提示顯示「熱點」位置提高命中概率；保守策略在中晚期更穩定，冒險策略能在短期內暴富。

與玩家等級關聯：
- 等級↑ 解鎖更多刮刮次數、提高初始提示精度、或使用「探測器」提高金出現率。

額外玩法：
- 每日特別礦脈：高風險天賦地塊，今天有更高稀有金塊機率。

---

## 4) 砍木頭小遊戲（Woodcutting — 瘋狂連點 / 綠色區節奏）
概念：以維持「效率條」在綠色區間為主的節奏遊戲；超出綠區會造成疲勞或樹木損害，過度連續會招蜂或野獸攻擊（小額風險）。

流程步驟：
1. 顯示一棵樹與一個往返的指針條（或滑動條，顯示綠區/紅區）。
2. 玩家在指針進入綠區時點擊以造成一次高效砍伐（增加 ChopMeter）；在紅區點擊會減少耐久或觸發負面事件。
3. 達到 ChopMeter 上限時樹倒，按本次表現給予木材數量與品質。
4. 特殊事件：蜂巢（必須快速按 NAC 按鈕避開）、樹中藏物（隨機出現寶箱）。

高分技巧：
- 保持節奏而非亂點，利用短暫連擊蓄力觸發「暴擊砍伐」。
- 遇到特殊事件時快速應對可以額外加分或避免損失。

與玩家等級關聯：
- 等級↑ 解鎖雙刃/電鋸等工具，縮短每次 minigame 時間但提高採集效率；也可解鎖『安蜂籠』減少被蜂攻擊的風險。

額外玩法：
- Boss 樹：低機率出現需要多人或高等級工具才能砍伐的巨樹，掉落大量稀有木材或特殊物品。

---

## 獎勵、分數與整合規則
- 每場 mini‑game 回傳：
  - `yieldMultiplier`（浮點數）→ 主系統用於計算最終獲得數量： gain = floor(baseYield * yieldMultiplier)
  - `qualityScore`（整數）→ 決定是否掉落稀有素材
  - `failureFlag`（bool）→ 失敗會帶來懲罰（例如工具耐久下降、節點暫停）
- 高分榜 / 成就系統：記錄玩家 mini‑game 高分，提供每日/每週排行榜與獎勵。
- 與主遊戲資源互動：玩家可花費少量資源（例如 50 食物）來啟動一次 mini‑game；根據玩得好壞獲得額外比例獎勵。

---

## 實作建議（UI / 技術細節）
- 使用現有 UI 框架（ImGui 或遊戲內 UI），在 Node 詳情視窗放入 mini‑game 快速啟動按鈕。
- 每個 mini‑game 使用簡單動畫與聲效提示（命中、錯誤、事件）。
- 為避免影響遊戲節奏，mini‑game 應可跳過（快速獲取平均收益），並有冷卻或資源成本以平衡使用頻率。
- 數值整合：mini‑game 結果只作為「倍率/品質/掉落」參數，不直接改寫主系統核心經濟（主系統仍按 baseYield 計算再乘上返回值）。

---

## 小結與好玩技巧建議
- 使採集從被動變主動：透過短小精悍且有回報的 mini‑games 增強玩家參與度。
- 給予玩家不同風格的選擇：想要穩定資源就跳過或保守玩，想要快速擴張與冒險就手動遊玩並搏高收益。
- 隨著玩家等級提升，mini‑game 本身也能進化（新事件、新工具、新獎勵），維持長期吸引力。

如需，我可以：
- 產生每個 mini‑game 的 UI wireframe SVG/PNG，或
- 為 `PrototypeGame` 實作一個最小 playable mini‑game （選定其中一個），包含 input 處理與輸出格式（`yieldMultiplier,qualityScore,failureFlag`）。

---

## UI 介面設計（快速規格）
- 入口：在資源節點詳情視窗放「開始迷你遊戲」按鈕；也可在 Gather 面板列出可用 mini‑game 快捷按鈕。
- 主畫面 HUD（啟動 mini‑game 時）：
  - 顯示 mini‑game 名稱、剩餘時間（倒數）、當前分數/目標分數、工具耐久（如適用）、一鍵跳過按鈕（消耗少量資源）。
  - 左上角：即時提示（例如 combo, perfect hit）。右上角：小地圖縮圖與暫停按鈕。
  - 下方：操作提示（例如「點擊以種植」、「空白鍵閃避蜂群」）。
- 音效與視覺回饋：成功音 / 失敗音、閃光 / 搖晃效果、分數浮動字（+10）與 combo 條。

---

## 教學（Tutorial）與首次引導流程
1. 首次玩家點擊某資源節點並選擇「手動採集」時，彈出簡短教學面板（Step‑by‑Step, 3 steps，含示意圖）：
   - Step 1：目標與操作提示（例如：在綠色區點擊以砍木）。
   - Step 2：風險提示（例如：錯誤會損失耐久/延長 respawnDelay）。
   - Step 3：獎勵示例（高分可獲稀有素材），並提供「試玩一次」按鈕。
2. 教學採用漸進式提示（first‑action tooltip）：當玩家第一次遇到新事件（蜂群、陷阱、boss）時顯示一次性提示。
3. 教學結束後在 Gather 面板新增「示範影片」小按鈕（短動畫 5–8 秒）可再次觀看要領。

---

## 分數系統（Score System）與計算範例
- 基本要素：每個 mini‑game 設定 `maxScore` 與 `baseYield`。
- 最終回傳值（範例公式）：
  - `yieldMultiplier = 1.0 + clamp(score / maxScore * scoreFactor, 0, maxMultiplier)`
  - `qualityScore = floor(score / (maxScore / qualityLevels))`（用於決定稀有掉落機率）
  - `failureFlag` 若觸發失敗條件則為 true。

- 範例參數（砍木頭）： `maxScore=100, scoreFactor=1.5, maxMultiplier=2.5`。
  - 玩家得 80 分 → yieldMultiplier = 1 + (80/100)*1.5 = 2.2 → 若 baseYield=20 木 → 得到 floor(20*2.2)=44 木。
- Combo 與 Perfect：連續成功可乘上額外 bonusMultiplier（例如 +0.1 每 5 連擊），並顯示浮動分數。

---

## HUD 與結果回饋（玩家可見）
- 即時資訊：當前得分、combo、剩餘時間、當前倍率預覽（即時計算並顯示小數）。
- 結束畫面：顯示「分數 / 倍率 / 掉落」與兩個按鈕：`Confirm`（將結果套用到主遊戲）與 `Retry`（可免費或付小額資源重玩）。
- 浮動事件提示：若落入失敗（failureFlag）則提示懲罰與避免方法。

---

## 排行榜、存檔與統計
- local leaderboard：每個玩家保存本地最高分、最近 10 次結果，並在 UI 顯示 Top3。
- global leaderboard（選擇實作）：後端 API 上傳得分，提供每日/每週排行與獎勵。
- analytics：記錄每次 mini‑game 使用頻率、平均分、跳過率供設計調整。

---

## 範例事件與 JSON 回傳格式
- mini‑game 結束後回傳 JSON：
```
{
  "game":"woodcut",
  "score":80,
  "maxScore":100,
  "yieldMultiplier":2.2,
  "qualityScore":2,
  "failure":false,
  "drops":[{"item":"rare_wood","qty":1}],
  "timestamp":1620000000
}
```
- 事件名稱（EventBus）： `OnMiniGameStart(gameId,nodeId)`, `OnMiniGameEnd(resultJSON)`, `OnMiniGameSkip(gameId)`。

---

## 與玩家主等級、工具系統結合建議
- 工具屬性：增加容錯（timing 窄化 / 擴大）、提高基礎採集速度（影響 baseYield）、降低耐久損耗機率。
- 主等級解鎖：更多格子、更長時間、更高 maxMultiplier、或直接解鎖特殊事件（boss 樹 / 天然富礦）。
- 可用消耗物：使用藥劑/增益（如短暫 slow motion、顯示熱點）提升短期表現。

---

## 小結
這份延伸內容為四種資源迷你遊戲提供了 UI 規格、教學流程、分數公式、HUD 設計、結果回傳格式與排行榜建議。下一步我可以：
- 產生每個 mini‑game 的 UI wireframe SVG（`wireframe-svg`），或
- 在 `PrototypeGame` 中實作其中一個 mini‑game（`implement-mini`），包含 input 處理與結果回傳格式，或
- 產生一份簡單的 ImGui 範例代碼（`imgui-sample`）。
