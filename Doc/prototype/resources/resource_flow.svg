<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700" viewBox="0 0 1200 700">
  <style>
    .box{fill:#fff;stroke:#333;stroke-width:2;rx:8;}
    .node{fill:#E8F5E9;stroke:#2E7D32;stroke-width:2}
    .worker{fill:#FFF8E1;stroke:#BF360C;stroke-width:2}
    .text{font-family:Arial,Helvetica,sans-serif;font-size:14px;fill:#222}
    .title{font-size:20px;font-weight:bold}
    .arrow{stroke:#333;stroke-width:2;marker-end:url(#arrowhead)}
    .muted{fill:#666}
    .badge{font-size:12px;fill:#fff}
  </style>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <text x="40" y="36" class="title text">資源採集流程示意圖（點擊節點 → 消耗 50 食物 → 工人出發 → 採集 → 返回）</text>

  <!-- Resource Node -->
  <g transform="translate(80,80)">
    <rect class="node" x="0" y="0" width="220" height="120" rx="12"/>
    <text x="18" y="28" class="text" style="font-weight:bold">Resource Node</text>
    <text x="18" y="52" class="text">Type: WOOD</text>
    <text x="18" y="72" class="text">YieldCur: <tspan id="svg-node-yield">500</tspan> / 500</text>
    <text x="18" y="92" class="text">Status: <tspan id="svg-node-status">Active</tspan></text>
    <!-- click area circle icon -->
    <circle cx="180" cy="30" r="18" fill="#FFC107" stroke="#FF9800" stroke-width="2" />
    <text x="172" y="36" class="text" style="font-size:12px;fill:#222">Click</text>
    <text x="172" y="52" class="text" style="font-size:11px;fill:#222">(cost 50 food)</text>
  </g>

  <!-- Worker -->
  <g transform="translate(420,240)">
    <rect class="worker" x="0" y="0" width="180" height="100" rx="10"/>
    <text x="12" y="28" class="text" style="font-weight:bold">Worker (idle)</text>
    <text x="12" y="52" class="text">Pos: Base</text>
    <text x="12" y="74" class="text">Task: <tspan id="svg-worker-task">idle</tspan></text>
  </g>

  <!-- Base -->
  <g transform="translate(380,420)">
    <rect class="box" x="0" y="0" width="260" height="120" rx="12" fill="#fff" stroke="#333"/>
    <text x="16" y="28" class="text" style="font-weight:bold">Base / Storage</text>
    <text x="16" y="52" class="text">Food: <tspan id="svg-food">200</tspan></text>
    <text x="16" y="74" class="text">Wood: <tspan id="svg-wood">200</tspan>  Metal: <tspan id="svg-metal">200</tspan></text>
    <text x="16" y="96" class="muted" style="font-size:12px">Clicking node consumes 50 food to dispatch 1 worker</text>
  </g>

  <!-- Arrows: base -> node travel -->
  <line x1="420" y1="290" x2="240" y2="140" class="arrow" />
  <text x="300" y="220" class="text">Travel to node (time = dist / speed)</text>

  <!-- Arrow: node -> worker gather -->
  <line x1="300" y1="160" x2="480" y2="260" class="arrow" />

  <!-- Gather action -->
  <g transform="translate(760,120)">
    <rect class="box" x="0" y="0" width="300" height="140" rx="12"/>
    <text x="18" y="28" class="text" style="font-weight:bold">Gather Phase</text>
    <text x="18" y="54" class="text">- Worker harvests: amount = speed * gatherRate * quality * dt</text>
    <text x="18" y="76" class="text">- Node yield reduces by that amount</text>
    <text x="18" y="98" class="text">- Worker stores collected (taskCollected)</text>
    <text x="18" y="120" class="muted" style="font-size:12px">If node yield <= 0 -> node.depleted (unavailable)</text>
  </g>

  <!-- Arrow: gather -> return -->
  <line x1="600" y1="280" x2="480" y2="420" class="arrow" />
  <text x="520" y="360" class="text">Return to Base with cargo</text>

  <!-- Deposit -->
  <g transform="translate(760,300)">
    <rect class="box" x="0" y="0" width="300" height="120" rx="12"/>
    <text x="18" y="32" class="text" style="font-weight:bold">Deposit / Upload</text>
    <text x="18" y="58" class="text">- Worker unloads taskCollected to Base</text>
    <text x="18" y="82" class="text">- Player resources increment accordingly</text>
    <text x="18" y="106" class="muted" style="font-size:12px">- Worker becomes idle and can be reassigned</text>
  </g>

  <!-- Regeneration note -->
  <g transform="translate(40,540)">
    <rect x="0" y="0" width="1120" height="120" rx="10" fill="#F3F7FF" stroke="#90A4AE" />
    <text x="12" y="28" class="text" style="font-weight:bold">再生與枯竭說明</text>
    <text x="12" y="56" class="text">- 當節點枯竭 (yieldCur <= 0)，標記為 Depleted 並觸發 respawnDelay（重生等待時間）</text>
    <text x="12" y="80" class="text">- 經過 respawnDelay 後以 regenRate 緩慢回復 yieldCur，或由玩家研究/技能加速回復。</text>
    <text x="12" y="104" class="muted" style="font-size:12px">Awesome ideas: hotspot events, transport lines, node upgrades, worker specialization</text>
  </g>

  <!-- small legend badges -->
  <rect x="980" y="36" width="180" height="44" rx="8" fill="#FFF8E1" stroke="#BF360C"/>
  <text x="992" y="60" class="text">點擊節點 → 消耗 50 食物 → 派遣 1 名工人</text>

</svg>
